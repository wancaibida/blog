<!DOCTYPE html>
<html lang="en">
  <head>
    
<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">















  <link rel="alternate" href="/atom.xml" title="W2X">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.6.0" />



<link rel="canonical" href="https://w2x.me/page/2/"/>


<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.6.0" />






  


  <script id="google_analytics">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-77440077-1', 'auto');
        ga('send', 'pageview');
  </script>


  <script id="baidu_push">
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>









    <title> W2X </title>
  </head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">W2X</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    
      <a href="/">
        <li class="mobile-menu-item">
          
          
            Home
          
        </li>
      </a>
    
      <a href="/archives/">
        <li class="mobile-menu-item">
          
          
            Archives
          
        </li>
      </a>
    
      <a href="/tags/">
        <li class="mobile-menu-item">
          
          
            Tags
          
        </li>
      </a>
    
      <a href="/categories/">
        <li class="mobile-menu-item">
          
          
            Categories
          
        </li>
      </a>
    
  </ul>
</nav>

    <div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">W2X</a>
</div>

<nav class="site-navbar">
  
    <ul id="menu" class="menu">
      
        <li class="menu-item">
          <a class="menu-item-link" href="/">
            
            
              Home
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            
            
              Archives
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/tags/">
            
            
              Tags
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/categories/">
            
            
              Categories
            
          </a>
        </li>
      
    </ul>
  
</nav>

      </header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content">
            
  <section id="posts" class="posts">
    
      
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          <a class="post-link" href="/2018/01/24/Alfred-argv与query的用法/">Alfred argv与query的用法</a>
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2018-01-24
        </span>
        
          <div class="post-category">
            
              <a href="/categories/mac-os/">mac os</a>
            
          </div>
        
        
      </div>
    </header>

    
    

    <div class="post-content">
      
        
        

        
          <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># Input as argv</span><br><span class="line">./myscript.sh $1</span><br><span class="line"> </span><br><span class="line"># Input as query macro</span><br><span class="line">./myscript.sh &#123;query&#125;</span><br></pre></td></tr></table></figure>

        
      
    </div>

    

    

  </article>

    
      
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          <a class="post-link" href="/2017/12/21/Grails-JSON-Views-教程/">Grails JSON Views 教程</a>
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2017-12-21
        </span>
        
          <div class="post-category">
            
              <a href="/categories/java/">java</a>
            
          </div>
        
        
      </div>
    </header>

    
    

    <div class="post-content">
      
        
        

        
          <p>Grails 3.2版本中的rest-api profile加入了JSON View插件，JSON View插件主要用于渲染JSON返回内容，类似于GSP，其好处就是将JSON渲染从控制器层移到了视图层，同时JSON View还能定义模板，继承等。</p>
<h2 id="开始使用"><a href="#开始使用" class="headerlink" title="开始使用"></a>开始使用</h2><h3 id="创建视图"><a href="#创建视图" class="headerlink" title="创建视图"></a>创建视图</h3><p>JSON View视图文件以<code>.gson</code>为扩展名，且文件要放在<code>grails-app/views</code>目录下。<br>例：person.gson</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">json.person &#123;</span><br><span class="line">    name &quot;bob&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>返回的JSON值为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;person&quot;:&#123;&quot;name&quot;:&quot;bob&quot;&#125;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="创建模版"><a href="#创建模版" class="headerlink" title="创建模版"></a>创建模版</h3><p>模版文件需要以<code>_</code>开头，比如你有一个类名叫QueryResult,则其模版文件完整路径为<code>grails-app/views/queryResult/_queryResult.gson</code><br>例：<code>Author.groovy</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">class Author &#123;</span><br><span class="line">    String name</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>模版：<code>grails-app/views/author/_author.gson</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">model &#123;</span><br><span class="line">    Author author</span><br><span class="line">&#125;</span><br><span class="line">json &#123;</span><br><span class="line">    name author.name</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>也可以简写为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@Field Author author</span><br><span class="line">json &#123;</span><br><span class="line">    name author.name</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果Author类是Domain Object的话，则模版文件可以写成：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@Field Author author</span><br><span class="line">json g.render(author)</span><br></pre></td></tr></table></figure>
<h3 id="高级用法"><a href="#高级用法" class="headerlink" title="高级用法"></a>高级用法</h3><h4 id="自定义字段"><a href="#自定义字段" class="headerlink" title="自定义字段"></a>自定义字段</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">model &#123;</span><br><span class="line">    Book book</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">json g.render(book, [deep: false, renderNulls: true]) &#123;</span><br><span class="line">    authorName book.author?.name</span><br><span class="line">    publishDate new Date().time</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="集合渲染"><a href="#集合渲染" class="headerlink" title="集合渲染"></a>集合渲染</h4><p>例1：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">model &#123;</span><br><span class="line">    Author author</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">json &#123;</span><br><span class="line">    name author.name</span><br><span class="line">    books g.render(template: &apos;/book/book&apos;, collection: author.books, var: &apos;book&apos;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>/book/book</code>引用的是<code>grails-app/views/book</code>目录下名为<code>_book.gson</code>的模版文件</p>
<p>例2：<br>如果返回结果是个集合，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">class AuthorController &#123;</span><br><span class="line">    static responseFormats = [&apos;json&apos;, &apos;xml&apos;]</span><br><span class="line"></span><br><span class="line">    def index() &#123;</span><br><span class="line">        /**</span><br><span class="line">         * 这里需要注意res的类型，</span><br><span class="line">         * 如果是List类型，则json view中的model名称则为authorList</span><br><span class="line">         * 如果是Set类型，则json view中的model名称则为authorSet</span><br><span class="line">         */</span><br><span class="line">        def res = Author.list()</span><br><span class="line">        respond(res, [view: &apos;authorList&apos;])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p><strong>这里要注意下<code>res</code>的类型</strong></p>
<ul>
<li>如果是List类型，则json view中的model名称则为authorList</li>
<li>如果是Set类型，则json view中的model名称则为authorSet</li>
</ul>
</li>
<li><p>Grails默认会在<code>grails-app/views/author/</code>路径下查找<code>authorList.gson</code>视图文件</p>
</li>
<li>如果需要在其他Controller下引用该视图的话，需要写绝对路径<code>/author/authorList</code></li>
</ul>
<p><code>_author.gson</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">model &#123;</span><br><span class="line">    Author author</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">json &#123;</span><br><span class="line">    name author.name</span><br><span class="line">    books g.render(template: &apos;/book/book&apos;, collection: author.books, var: &apos;book&apos;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>authorList.gson</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">model &#123;</span><br><span class="line">    Collection&lt;Author&gt; authorList = []</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">json tmpl.author(authorList)</span><br></pre></td></tr></table></figure>
<p><strong>authorList要指定下默认值<code>[]</code>，如果不指定的话会返回<code>[null]</code>这种JSON</strong></p>
<h4 id="渲染参数"><a href="#渲染参数" class="headerlink" title="渲染参数"></a>渲染参数</h4><p>你可以通过<code>includes</code>和<code>excludes</code>参数，来包含或排除一些字段，如</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@Field Author author</span><br><span class="line">json g.render(author，[includes:[&apos;title&apos;])</span><br></pre></td></tr></table></figure>
<p>你也可以自定义额外输出的内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">json g.render(author) &#123;</span><br><span class="line">    age 30</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在默认情况下，JSON View不会返回值为<code>null</code>的字段，如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">class Author &#123;</span><br><span class="line">    String name</span><br><span class="line">    Integer age</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Field Author author</span><br><span class="line">json g.render(author)</span><br><span class="line"></span><br><span class="line">def a = new Author(name: &apos;charles&apos;,age: 12) =&gt; &#123;name:&apos;chalres&apos;,age: 12&#125;</span><br><span class="line">def b = new Author(name: null,age: 29)=&gt; &#123;age: 29&#125;</span><br></pre></td></tr></table></figure>
<p>这时候你可以设直<code>renderNulls</code>来返回空值字段：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@Field Author author</span><br><span class="line">json g.render(author,[renderNulls: true])</span><br></pre></td></tr></table></figure>
<p>则b的返回中就变成：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">def b = new Author(name: null,age: 29)=&gt; &#123;name: null,age: 29&#125;</span><br></pre></td></tr></table></figure>
<h3 id="完整的例子"><a href="#完整的例子" class="headerlink" title="完整的例子"></a>完整的例子</h3><p><a href="https://github.com/wancaibida/grails-json-views-example" target="_blank" rel="noopener">https://github.com/wancaibida/grails-json-views-example</a></p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>JSON View用下来还是遇到了不少的问题，主要原因是其约定太多且官方的文档也说的不是很清楚，有 些地方还是要一步步调试来研究源代码，但总的来说比传统的在代码中指定JSON格式方便了不少，用好了能节约不少时间与工作量。</p>
<h4 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h4><p><a href="https://github.com/skyboy101/widget-store-rest-api" target="_blank" rel="noopener">https://github.com/skyboy101/widget-store-rest-api</a><br><a href="http://views.grails.org/1.1.x/" target="_blank" rel="noopener">http://views.grails.org/1.1.x/</a></p>

        
      
    </div>

    

    

  </article>

    
      
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          <a class="post-link" href="/2017/12/03/记一个Grails-JSON-Views的Bug/">记一个Grails JSON Views的Bug</a>
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2017-12-03
        </span>
        
          <div class="post-category">
            
              <a href="/categories/java/">java</a>
            
          </div>
        
        
      </div>
    </header>

    
    

    <div class="post-content">
      
        
        

        
          <p>最近项目用到了3.2版本的Grails，这个版本中引入了一个新特性JSON views，主要作用是将JSON返回内容视为一种视图,类似于GSP。其好处就是可以在视图层定义返回json的格式，而且可以定义bean的JSON模版，比较灵活。</p>
<p>项目中有一个名为<code>QueryResult</code>的类，并设置了<code>QueryResult</code>类的模版，名为<code>_queryresult.gson</code>。</p>
<p>文件目录如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">bean</span><br><span class="line">    package...</span><br><span class="line">        QueryResult.groovy</span><br><span class="line">views</span><br><span class="line">    queryResult</span><br><span class="line">        _queryresult.gson</span><br></pre></td></tr></table></figure>
<p>Controller代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">def list(xxx)&#123;</span><br><span class="line">    new QueryResult(xxx)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>项目在本地开发时没有什么问题，但部署到生产环境时，这个方法返回内空始终为空。</p>
<p>项目在本地开发时是在内置的tomcat运行的，而在生产环境中项目是打包成war文件部署在Linux下的Tomcat。猜测问题可能是项目运行方式不同导致。</p>
<p>调试后发现了如下代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">WritableScriptTemplate template</span><br><span class="line">if (Environment.isDevelopmentEnvironmentAvailable()) &#123;</span><br><span class="line">    template = attemptResolvePath(path)</span><br><span class="line">    if (template == null) &#123;</span><br><span class="line">        template = attemptResolveClass(path)</span><br><span class="line">    &#125;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    template = attemptResolveClass(path)</span><br><span class="line">    if (template == null) &#123;</span><br><span class="line">        template = attemptResolvePath(path)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">if (template == null) &#123;</span><br><span class="line">    template = NULL_ENTRY</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>代码的基本意思是，如果是在开发环境下，模版内容优先通过文件路径来查找，如果没有找到则通过类名来查找，而在生产环境正好反过来。</p>
<p>模版文件<code>_queryresult.gson</code>编译后会生成名为<code>xxx_queryResult__queryresult_gson.class</code>的java类。</p>
<p>JSON Views插件会通过一系列约定的命名方式来找所需要的视图，最终会查找名为<code>xxx_queryResult__queryResult_gson.class</code>的java类（注意：第二个queryResult中的R是大写的），前面说到开发环境下会先通过文件名称来查找，即</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//实际文件名为：xxx_queryResult__queryresult_gson.class</span><br><span class="line">def templateFile = new File(&apos;xxx_queryResult__queryResult_gson.class&apos;)</span><br><span class="line">if(templateFile.exist())&#123;</span><br><span class="line">    return templateFile;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>，如果文件存在，则返回。可实际的class文件名为<code>xxx_queryResult__queryresult_gson.class</code>，但我开发环境的文件系统是<strong>大小写不敏感</strong>的！！，所以对于系统来说<code>xxx_queryResult__queryresult_gson.class</code>和<code>xxx_queryResult__queryResult_gson.class</code>是同样的文件名，<code>exist</code>方法最终是通过系统的API来寻找文件的，所以<code>templateFile.exist()</code>这句返回结果为真。</p>
<p>在生产环境是下是优先通过类名来查找的，要查找的类名为<code>xxx_queryResult__queryResult_gson.class</code>，而实际的类名为<code>xxx_queryResult__queryresult_gson.class</code>，而java类名是区分大小写的，所以会导致类找不到。</p>
<p>一旦通过类名查找不成功，则会通过文件路径来查，而Linux的文件系统是<strong>大小写敏感</strong>的，所以会无法找到名为<code>xxx_queryResult__queryResult_gson.class</code>的文件。</p>
<p>最终把模版文件名重命名为<code>_queryResult.gson</code>，接口就运行正常了。</p>
<p>总结：<br>严格来说这个BUG是文件系统对大小写处理的差异导制的，所以在开发时要考虑到文件系统对大小写处理不一致的问题。</p>

        
      
    </div>

    

    

  </article>

    
      
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          <a class="post-link" href="/2017/12/02/Intellij远程调试Tomcat/">Intellij远程调试Tomcat</a>
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2017-12-02
        </span>
        
          <div class="post-category">
            
              <a href="/categories/ide/">ide</a>
            
          </div>
        
        
      </div>
    </header>

    
    

    <div class="post-content">
      
        
        

        
          <ol>
<li>在Tomcat下新建<code>setenv.sh</code>文件</li>
<li>运行<code>chmod 755 setenv.sh</code></li>
<li><p>将下面的代码添加到<code>setenv.sh</code>文件中</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export CATALINA_OPTS=&quot;-agentlib:jdwp=transport=dt_socket,address=1043,server=y,suspend=n&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Intellij Run/Debug Configurations下新建Tomcat Server Remote<br><img src="http://static.w2x.me/2017-12-02-Screen Shot 2017-12-02 at 13.53.42.png" alt="Screen Shot 2017-12-02 at 13.53.42"></p>
</li>
<li><p>在新建的页面先择<code>Starup/Connection</code>标签,然后选择Debug选项<br><img src="http://static.w2x.me/2017-12-02-Screen Shot 2017-12-02 at 13.56.20.png" alt="Screen Shot 2017-12-02 at 13.56.20"></p>
</li>
<li><p>将<code>Port</code>的值修改为<code>1043</code><br><img src="http://static.w2x.me/2017-12-02-Screen Shot 2017-12-02 at 13.58.42.png" alt="Screen Shot 2017-12-02 at 13.58.42"></p>
</li>
<li><p>Tomcat启动后,Intellij即可远程Debug</p>
</li>
</ol>

        
      
    </div>

    

    

  </article>

    
      
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          <a class="post-link" href="/2017/11/20/Kubernetes入门/">Kubernetes入门</a>
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2017-11-20
        </span>
        
          <div class="post-category">
            
              <a href="/categories/docker/">docker</a>
            
          </div>
        
        
      </div>
    </header>

    
    

    <div class="post-content">
      
        
        

        
          <h1 id="Kubernetes入门"><a href="#Kubernetes入门" class="headerlink" title="Kubernetes入门"></a>Kubernetes入门</h1><h2 id="Kubernetes是什么"><a href="#Kubernetes是什么" class="headerlink" title="Kubernetes是什么"></a>Kubernetes是什么</h2><p>Kubernetes是用来自动化部署,扩展,管理容器应用的工具.</p>
<h2 id="Kubernetes架构"><a href="#Kubernetes架构" class="headerlink" title="Kubernetes架构"></a>Kubernetes架构</h2><p>Kubernetes主要由Master和Node两部分组成.<br><img src="http://static.w2x.me/0.png" alt="Architecture"></p>
<h3 id="Master"><a href="#Master" class="headerlink" title="Master"></a>Master</h3><p>Kubernetes集群包含至少一个Master节点和多个Node节点.Master节点主要用来暴露API,调度部署和管理整个集群.</p>
<h3 id="Node"><a href="#Node" class="headerlink" title="Node"></a>Node</h3><p>Node是工作节点,Node可能是物理机器也可能是虚拟机,每个节点上都提供了容器的运行环境,比如说Docker,rkt.</p>
<h2 id="Kubernetes对象"><a href="#Kubernetes对象" class="headerlink" title="Kubernetes对象"></a>Kubernetes对象</h2><p>Kubernetes对象持久化在kubernetes系统中,Kubernetes用这些对象来描述集群的状态,比如:</p>
<ul>
<li>部署的应用</li>
<li>应用的行为,比如重启,升级策略</li>
<li>应用程序可用的资源</li>
</ul>
<h3 id="描述Kubernetes对象"><a href="#描述Kubernetes对象" class="headerlink" title="描述Kubernetes对象"></a>描述Kubernetes对象</h3><p>我们通常会通过.yaml来描述Kuberntes对象,Kubernetes客户端会将yaml文件转成JSON来调用API.<br>例:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: apps/v1beta1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-deployment</span><br><span class="line">spec:</span><br><span class="line">  replicas: 3</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: nginx</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: nginx</span><br><span class="line">        image: nginx:1.7.9</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 80</span><br></pre></td></tr></table></figure>
<p>我们可以通过下面的命令来创建Kubernetes对象:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create -f docs/user-guide/nginx-deployment.yaml --record</span><br></pre></td></tr></table></figure>
<h4 id="字段说明"><a href="#字段说明" class="headerlink" title="字段说明"></a>字段说明</h4><p>在yaml文件中,你需要声明以下字段:</p>
<ul>
<li>apiVersion - 调用的API版本</li>
<li>kind - 对象类型</li>
<li>metadata - 用于查找对象的字段,比如名称,UID,命名空间</li>
</ul>
<p>一些常见的kubernetes对象有:</p>
<ul>
<li>Pod</li>
<li>Deployments</li>
<li>Service</li>
<li>Ingress</li>
</ul>
<h3 id="Pod对象"><a href="#Pod对象" class="headerlink" title="Pod对象"></a>Pod对象</h3><p>Pod对象是最小的布署单元,包含了一个或多个容器.通常我们不会单独使用Pod.<br>Controller对象可创建多个Pod,常风的Controller对象有:</p>
<ul>
<li>Deployment</li>
<li>StatefulSet</li>
<li>DaemonSet</li>
</ul>
<h3 id="Deployments对象"><a href="#Deployments对象" class="headerlink" title="Deployments对象"></a>Deployments对象</h3><p>Deployments对象可以创建Pod,在Deployments对象中你只需要描述你需要的状态,Deployments对象会将当前状态改变成你所需要的状态.</p>
<p> 例:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: apps/v1beta1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-deployment</span><br><span class="line">spec:</span><br><span class="line">  replicas: 3</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: nginx</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: nginx</span><br><span class="line">        image: nginx:1.7.9</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 80</span><br></pre></td></tr></table></figure>
<p>上面的描述文件创建了3个运行Nginx的Pod对象.</p>
<p>通过下面命令来部署和查看Deployments对象:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl create -f docs/user-guide/nginx-deployment.yaml --record</span><br><span class="line">kubectl get deployment</span><br></pre></td></tr></table></figure>
<h3 id="Service对象"><a href="#Service对象" class="headerlink" title="Service对象"></a>Service对象</h3><p>Service对象将Pod对象抽像成一种服务,并定义了访问这些Pod对象的策略,类似于负载均衡(Loadbalancer).Service对象会通过选择器来选择Pod对象.</p>
<p>例:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">kind: Service</span><br><span class="line">apiVersion: v1</span><br><span class="line">metadata:</span><br><span class="line">  name: my-service</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    app: MyApp</span><br><span class="line">  ports:</span><br><span class="line">    - protocol: TCP</span><br><span class="line">      port: 80</span><br><span class="line">      targetPort: 9376</span><br></pre></td></tr></table></figure>
<h3 id="Ingress对象"><a href="#Ingress对象" class="headerlink" title="Ingress对象"></a>Ingress对象</h3><p>Ingress对象定义了外部请求如何转发到Service,类似于反向代理.<br>例:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: extensions/v1beta1</span><br><span class="line">kind: Ingress</span><br><span class="line">metadata:</span><br><span class="line">  name: test</span><br><span class="line">  annotations:</span><br><span class="line">    ingress.kubernetes.io/rewrite-target: /</span><br><span class="line">spec:</span><br><span class="line">  rules:</span><br><span class="line">  - host: foo.bar.com</span><br><span class="line">    http:</span><br><span class="line">      paths:</span><br><span class="line">      - path: /foo</span><br><span class="line">        backend:</span><br><span class="line">          serviceName: s1</span><br><span class="line">          servicePort: 80</span><br><span class="line">      - path: /bar</span><br><span class="line">        backend:</span><br><span class="line">          serviceName: s2</span><br><span class="line">          servicePort: 80</span><br></pre></td></tr></table></figure>
<p>上面的描述文件定义了Service的访问规则,foo上下文路径会被转发到名为s1的Service,bar上下文路径转发到名为s2的Service.</p>
<p>简而言之:</p>
<ul>
<li>Deployments定义了怎样部署应用(应用image,部署多少实例,启动策略等);</li>
<li>Service定义了如何抽像Deployments为服务,类似于负载均衡;</li>
<li>Ingress定义了请求如何转发到Service,类似反向代理,如nginx.</li>
</ul>

        
      
    </div>

    

    

  </article>

    
  </section>

  
  <nav class="pagination">
    
      <a class="prev" href="/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text">Prev</span>
      </a>
    
    
      <a class="next" href="/page/3/">
        <span class="next-text">Next</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>


          </div>
          

        </div>
      </main>

      <footer id="footer" class="footer">

  <div class="social-links">
    
      
        
          <a href="mailto:wancaibida@gmail.com" class="iconfont icon-email" title="email"></a>
        
      
    
      
    
      
    
      
    
      
    
      
    
      
        
          <a href="https://github.com/wancaibida" class="iconfont icon-github" title="github"></a>
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    
    
    
      <a href="/atom.xml" class="iconfont icon-rss" title="rss"></a>
    
  </div>


<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://hexo.io/">Hexo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/ahonn/hexo-theme-even">Even</a>
  </span>

  <span class="copyright-year">
    
    &copy; 
     
      2015 - 
    
    2018

    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">大丈夫没问题</span>
  </span>
</div>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>

    


    




  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  
    <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  

  


    <script type="text/javascript" src="/js/src/even.js?v=2.6.0"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=2.6.0"></script>

  </body>
</html>
